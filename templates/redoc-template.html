<!DOCTYPE html>
<html>
<head>
  <title>{{SERVICE_NAME}} API Documentation - {{VERSION}}</title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary-color: #2196F3;
      --primary-dark: #1976D2;
      --success-color: #4CAF50;
      --warning-color: #FF9800;
      --error-color: #F44336;
      --info-color: #2196F3;

      --bg-primary: #ffffff;
      --bg-secondary: #f8f9fa;
      --bg-tertiary: #e9ecef;

      --text-primary: #212529;
      --text-secondary: #6c757d;
      --text-muted: #868e96;

      --border-color: #dee2e6;
      --shadow-light: 0 2px 4px rgba(0,0,0,0.1);
      --shadow-medium: 0 4px 8px rgba(0,0,0,0.15);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
    }

    /* Enhanced Header */
    .api-header {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 24px 0;
      box-shadow: var(--shadow-medium);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
    }

    .header-main {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .service-logo {
      width: 48px;
      height: 48px;
      background: rgba(255,255,255,0.2);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 20px;
    }

    .service-title {
      margin: 0;
      font-size: 28px;
      font-weight: 600;
      line-height: 1.2;
    }

    .service-description {
      margin: 4px 0 0 0;
      font-size: 16px;
      opacity: 0.9;
      font-weight: 400;
    }

    .header-meta {
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .version-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: rgba(255,255,255,0.2);
      border-radius: 20px;
      font-weight: 500;
      font-size: 14px;
      backdrop-filter: blur(10px);
    }

    .deployment-badge {
      padding: 6px 12px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .deployment-badge.release {
      background: var(--success-color);
      color: white;
    }

    .deployment-badge.development {
      background: var(--warning-color);
      color: white;
    }

    /* Navigation Bar */
    .nav-bar {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      padding: 12px 0;
      position: sticky;
      top: 96px;
      z-index: 999;
    }

    .nav-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
    }

    .nav-links {
      display: flex;
      gap: 24px;
      align-items: center;
    }

    .nav-link {
      color: var(--text-secondary);
      text-decoration: none;
      font-weight: 500;
      font-size: 14px;
      padding: 8px 16px;
      border-radius: 6px;
      transition: all 0.2s ease;
    }

    .nav-link:hover, .nav-link.active {
      color: var(--primary-color);
      background: rgba(33, 150, 243, 0.1);
    }

    .nav-actions {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .btn {
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      text-decoration: none;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary {
      background: var(--primary-color);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .btn-outline {
      background: transparent;
      color: var(--primary-color);
      border: 1px solid var(--primary-color);
    }

    .btn-outline:hover {
      background: var(--primary-color);
      color: white;
    }

    /* Change Summary Panel */
    .change-summary {
      background: var(--bg-secondary);
      border-left: 4px solid var(--info-color);
      padding: 16px 20px;
      margin: 24px;
      border-radius: 0 8px 8px 0;
      display: none; /* Show only when changes detected */
    }

    .change-summary.has-changes {
      display: block;
    }

    .change-summary.breaking {
      border-left-color: var(--error-color);
      background: #fff5f5;
    }

    .change-summary.new-endpoints {
      border-left-color: var(--success-color);
      background: #f0fff4;
    }

    .change-summary-title {
      font-weight: 600;
      font-size: 16px;
      margin: 0 0 12px 0;
      color: var(--text-primary);
    }

    .change-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin-top: 12px;
    }

    .change-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid var(--border-color);
    }

    .change-type {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      padding: 4px 8px;
      border-radius: 4px;
      display: inline-block;
      margin-bottom: 8px;
    }

    .change-type.breaking { background: #ffebee; color: #c62828; }
    .change-type.new { background: #e8f5e8; color: #2e7d2e; }
    .change-type.modified { background: #fff3e0; color: #ef6c00; }

    /* Version Selector */
    .version-selector {
      position: relative;
      display: inline-block;
    }

    .version-dropdown {
      padding: 8px 12px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      background: white;
      font-size: 14px;
      cursor: pointer;
      min-width: 120px;
    }

    /* Development Warning */
    .dev-warning {
      background: linear-gradient(90deg, #fff3cd, #ffeaa7);
      border: 1px solid #ffeaa7;
      padding: 12px 20px;
      margin: 0;
      display: none;
      align-items: center;
      gap: 12px;
      font-size: 14px;
      font-weight: 500;
    }

    .dev-warning.show {
      display: flex;
    }

    .dev-warning-icon {
      font-size: 18px;
    }

    /* Content Container */
    .content-container {
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
    }

    /* Custom Redoc Overrides */
    #redoc-container {
      padding: 0;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .header-content {
        text-align: center;
      }

      .service-title {
        font-size: 24px;
      }

      .nav-content {
        flex-direction: column;
        align-items: stretch;
      }

      .nav-links {
        justify-content: center;
      }

      .nav-actions {
        justify-content: center;
      }

      .change-list {
        grid-template-columns: 1fr;
      }
    }

    /* Print Styles */
    @media print {
      .api-header,
      .nav-bar,
      .change-summary {
        display: none !important;
      }
    }

    /* Dark Mode Support */
    @media (prefers-color-scheme: dark) {
      :root {
        --bg-primary: #1a1a1a;
        --bg-secondary: #2d2d2d;
        --bg-tertiary: #404040;
        --text-primary: #ffffff;
        --text-secondary: #b3b3b3;
        --text-muted: #808080;
        --border-color: #404040;
      }

      .change-item {
        background: var(--bg-tertiary);
        border-color: var(--border-color);
      }

      .version-dropdown {
        background: var(--bg-secondary);
        border-color: var(--border-color);
        color: var(--text-primary);
      }
    }
  </style>
</head>
<body>
<!-- Enhanced Header -->
<header class="api-header">
  <div class="header-content">
    <div class="header-main">
      <div class="service-logo">
        {{SERVICE_LOGO}}
      </div>
      <div>
        <h1 class="service-title">{{SERVICE_NAME}}</h1>
        <p class="service-description">{{SERVICE_DESCRIPTION}}</p>
      </div>
    </div>
    <div class="header-meta">
      <div class="version-badge">
        <span>Version</span>
        <strong>{{VERSION}}</strong>
      </div>
      <div class="deployment-badge {{DEPLOYMENT_TYPE}}">
        {{DEPLOYMENT_TYPE}}
      </div>
    </div>
  </div>
</header>

<!-- Development Warning -->
<div class="dev-warning {{DEV_WARNING_CLASS}}">
  <span class="dev-warning-icon">‚ö†Ô∏è</span>
  <span>This is development documentation and may be removed after 7 days. For stable documentation, please refer to the latest release version.</span>
</div>

<!-- Navigation Bar -->
<nav class="nav-bar">
  <div class="nav-content">
    <div class="nav-links">
      <a href="#overview" class="nav-link active">Overview</a>
      <a href="#authentication" class="nav-link">Authentication</a>
      <a href="#endpoints" class="nav-link">Endpoints</a>
      <a href="#schemas" class="nav-link">Schemas</a>
      <a href="#changes" class="nav-link">Changes</a>
    </div>
    <div class="nav-actions">
      <div class="version-selector">
        <select class="version-dropdown" id="versionSelector">
          <option value="{{VERSION}}">{{VERSION}} (Current)</option>
          <!-- Populated by JavaScript -->
        </select>
      </div>
      <a href="{{OPENAPI_SPEC_URL}}" class="btn btn-outline" target="_blank">
        <span>üìÑ</span>
        OpenAPI Spec
      </a>
      <a href="{{GITHUB_REPO_URL}}" class="btn btn-primary" target="_blank">
        <span>üìö</span>
        Source Code
      </a>
    </div>
  </div>
</nav>

<!-- Change Summary Panel -->
<div class="change-summary {{CHANGE_SUMMARY_CLASS}}" id="changeSummary">
  <h3 class="change-summary-title">{{CHANGE_SUMMARY_TITLE}}</h3>
  <div id="changeDetails">
    <!-- Populated by JavaScript from changes.json -->
  </div>
</div>

<!-- Main Content -->
<div class="content-container">
  <div id="redoc-container"></div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/redoc@2.0.0/bundles/redoc.standalone.js"></script>
<script>
  // Enhanced Redoc Configuration
  const redocOptions = {
    theme: {
      colors: {
        primary: {
          main: '#2196F3'
        },
        success: {
          main: '#4CAF50'
        },
        warning: {
          main: '#FF9800'
        },
        error: {
          main: '#F44336'
        }
      },
      typography: {
        fontSize: '14px',
        lineHeight: '1.6',
        code: {
          fontSize: '13px',
          fontFamily: "'JetBrains Mono', 'Monaco', 'Consolas', monospace"
        },
        headings: {
          fontFamily: "'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif",
          fontWeight: '600'
        }
      },
      sidebar: {
        backgroundColor: '#fafbfc',
        textColor: '#32363a',
        groupItems: {
          textTransform: 'uppercase',
          fontWeight: '600'
        }
      },
      rightPanel: {
        backgroundColor: '#f8f9fa',
        textColor: '#32363a'
      }
    },
    scrollYOffset: 150,
    hideDownloadButton: false,
    disableSearch: false,
    expandResponses: '200,201',
    showExtensions: true,
    sortPropsAlphabetically: true,
    menuToggle: true,
    pathInMiddlePanel: true,
    requiredPropsFirst: true,
    hideHostname: false,
    expandDefaultServerVariables: true,
    maxDisplayedEnumValues: 10,
    jsonSampleExpandLevel: 2,
    hideSchemaPattern: false,
    generateCodeSamples: {
      languages: [
        { lang: 'curl', label: 'cURL' },
        { lang: 'javascript', label: 'JavaScript' },
        { lang: 'python', label: 'Python' },
        { lang: 'java', label: 'Java' },
        { lang: 'kotlin', label: 'Kotlin' }
      ]
    }
  };

  // Initialize Redoc
  Redoc.init('openapi.json', redocOptions, document.getElementById('redoc-container'));

  // Load and display changes
  async function loadChanges() {
    try {
      const response = await fetch('changes.json');
      const changes = await response.json();
      displayChanges(changes);
    } catch (error) {
      console.warn('Could not load changes:', error);
    }
  }

  function displayChanges(changes) {
    const changeSummary = document.getElementById('changeSummary');
    const changeDetails = document.getElementById('changeDetails');

    if (changes.summary.breaking_changes_count > 0 ||
        changes.summary.new_endpoints_count > 0 ||
        changes.summary.modified_endpoints_count > 0) {

      changeSummary.classList.add('has-changes');

      if (changes.summary.breaking_changes_count > 0) {
        changeSummary.classList.add('breaking');
      } else if (changes.summary.new_endpoints_count > 0) {
        changeSummary.classList.add('new-endpoints');
      }

      let html = '<div class="change-list">';

      if (changes.breaking_changes && changes.breaking_changes.length > 0) {
        html += '<div class="change-item">';
        html += '<div class="change-type breaking">Breaking Changes</div>';
        changes.breaking_changes.forEach(change => {
          html += `<div>‚Ä¢ ${change.description}</div>`;
        });
        html += '</div>';
      }

      if (changes.new_endpoints && changes.new_endpoints.length > 0) {
        html += '<div class="change-item">';
        html += '<div class="change-type new">New Endpoints</div>';
        changes.new_endpoints.slice(0, 5).forEach(endpoint => {
          html += `<div>‚Ä¢ ${endpoint.method} ${endpoint.path}</div>`;
        });
        if (changes.new_endpoints.length > 5) {
          html += `<div>‚Ä¢ ... and ${changes.new_endpoints.length - 5} more</div>`;
        }
        html += '</div>';
      }

      if (changes.modified_endpoints && changes.modified_endpoints.length > 0) {
        html += '<div class="change-item">';
        html += '<div class="change-type modified">Modified Endpoints</div>';
        changes.modified_endpoints.slice(0, 5).forEach(endpoint => {
          html += `<div>‚Ä¢ ${endpoint.method} ${endpoint.path} (${endpoint.changes.length} changes)</div>`;
        });
        if (changes.modified_endpoints.length > 5) {
          html += `<div>‚Ä¢ ... and ${changes.modified_endpoints.length - 5} more</div>`;
        }
        html += '</div>';
      }

      html += '</div>';
      changeDetails.innerHTML = html;
    }
  }

  // Load available versions for dropdown
  async function loadVersions() {
    try {
      const response = await fetch('../timeline.json');
      const timeline = await response.json();
      const versionSelector = document.getElementById('versionSelector');

      if (timeline && timeline.versions) {
        timeline.versions.forEach(version => {
          if (version.version !== '{{VERSION}}') {
            const option = document.createElement('option');
            option.value = version.version;
            option.textContent = `${version.version} (${version.type})`;
            versionSelector.appendChild(option);
          }
        });
      }
    } catch (error) {
      console.warn('Could not load version timeline:', error);
    }
  }

  // Handle version selection
  document.getElementById('versionSelector').addEventListener('change', function(e) {
    const selectedVersion = e.target.value;
    if (selectedVersion && selectedVersion !== '{{VERSION}}') {
      const currentPath = window.location.pathname;
      const basePath = currentPath.substring(0, currentPath.lastIndexOf('/'));
      window.location.href = `${basePath}/../${selectedVersion}/`;
    }
  });

  // Smooth scroll for navigation
  document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    });
  });

  // Initialize
  document.addEventListener('DOMContentLoaded', function() {
    loadChanges();
    loadVersions();
  });
</script>
</body>
</html>